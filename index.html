<html>
<head>
  <title>Welcoming Wilkinson #2!</title>
</head>
<body>
<div id="title" class="slide header">
  <h1>Dan and Nicole Wilkinson
  <h2>Welcome Max' Little Sister or Brother!</h2></h1>
</div>

<div id="slide1" class="slide">
  <div class="title">
    <h1>If you believe the old wives tales&hellip;</h1>
    <p>there are clues:</p>
    <img src="./img/Old Wives tales.jpg"/>
  </div>
</div>

<div id="slide2" class="slide">
  <div class="title">
    <h1>So&hellip;
    <h2>What do <em>you</em> think?</h2></h1>
  </div>
  <iframe src="https://docs.google.com/forms/d/e/1FAIpQLSdkIJ9y6lSp4S_CQU3HBvSputtyEVqDHWldy5kcWSgod9iURw/viewform?embedded=true" width="600" height="700" frameborder="0" marginheight="0" marginwidth="0">&hellip;</iframe>
</div>

<div id="slide3" class="slide">
  <div class="title">
    <h1>Scratch to find out!</h1>
    <p>Drag your mouse over the area below.</p>
  </div>
    <canvas id="confetti"></canvas>
  <div class="scratch-container">
    <canvas class="scratch-canvas" width="512" height="362"></canvas>
    <div class="scratch-prize"></div>
  </div>
</div>

<div id="slide4" class="slide header">
  <div class="title">
    <h1>Joining our family
    <h2>January 2017!</h2></h1>
  </div>
</div>

<img id="scratchPreload" src="./img/scratch-prize.jpg" style="visibility:hidden;position:absolute;"/>

<style>
@font-face {
  font-family: 'LucidaCalligraphy-Italic';
  src: url('./fonts/LucidaCalligraphy-Italic.eot');
  src: url('./fonts/LucidaCalligraphy-Italic.woff2') format('woff2'),
  url('./fonts/LucidaCalligraphy-Italic.woff') format('woff'),
  url('./fonts/LucidaCalligraphy-Italic.eot?#iefix') format('embedded-opentype');
  font-weight: normal;
  font-style: normal;
}
</style>

<style>
  html {
    height: 100%;
    overflow: hidden;
  }

  body {
    margin:0;
    padding:0;
    perspective: 1px;
    transform-style: preserve-3d;
    height: 100%;
    min-width: 620px;
    overflow-y: scroll;
    overflow-x: hidden;
    font-family: LucidaCalligraphy-Italic;
    background-image: url(./img/girl-or-boy-colors.jpg);
    background-size: contain;
  }

  h1 {
   font-size: 250%
 }

 p {
  font-size: 130%;
  line-height: 150%;
  color: #fff;
}

.slide {
  position: relative;
  padding: 25vh 10%;
  min-height: 100vh;
  width: 100vw;
  box-sizing: border-box;
  transform-style: inherit;
}

img {
  position: absolute;
  top: 50%;
  left: 35%;
  width: 320px;
  height: 240px;
  transform: translateZ(.25px) scale(.75) translateX(-94%) translateY(-100%) rotate(2deg);
  padding: 10px;
  border-radius: 5px;
  background: rgba(240,230,220, .7);
  box-shadow: 0 0 8px rgba(0, 0, 0, .7);
}

img:last-of-type {
  transform: translateZ(0.5px) scale(0.6) translateX(49%) translateY(-26%) rotate(9deg);
}

.slide:before {
  content: "";
  position: absolute;
  top: 0;
  bottom: 0;
  left:0;
  right:0;
}

.title {
  width: 45%;
  padding: 5%;
  border-radius: 5px;
  color: #fff;
  text-shadow: 0 2px 2px #000;
  background: rgba(240,230,220, .7);
  box-shadow: 0 0 8px rgba(0, 0, 0, .7);
  background-color: rgba(255, 255, 255, .4);
  background-image:
  -webkit-linear-gradient(left, rgba(0,0,0,0) 0%, rgba(97,97,97,0) 38%, rgba(255,255,255,1) 100%);
  background-image:
  -o-linear-gradient(left, rgba(0,0,0,0) 0%, rgba(97,97,97,0) 38%, rgba(255,255,255,1) 100%);
  background-image:
  linear-gradient(to right, rgba(0,0,0,0) 0%, rgba(97,97,97,0) 38%, rgba(255,255,255,1) 100%);
}
#title h1 {
  position: relative;
  top: -2.9em;
}
#title h2 {
  position: relative;
  top: 1em;
}

.slide:nth-child(2n) .title {
  margin-left: 0;
  margin-right: auto;
}

.slide:nth-child(2n+1) .title {
  margin: auto;
  width: 80%;
}



.slide, .slide:before {
  background: 50% 50% / cover;
}

.header {
  text-align: center;
  font-size: 175%;
  color: #fff;
  text-shadow: 0 2px 2px #000;
}

#title {
  background-image: url(./img/girl-or-boy.jpg);
  background-attachment: fixed;
}

#slide1:before {
  background-image: url(./img/girl-or-boy-colors.jpg);
  background-size: contain;
  transform: translateZ(-1px) scale(2);
  z-index:-1;
}

#slide2 {
  background-image: url(./img/girl-or-boy-colors.jpg);
  background-size: contain;
  background-attachment: fixed;
}
#slide2 .title {
  margin: 1em auto;
}

#slide2 iframe {
  position: relative;
  left: calc(50% - 300px);
}

#slide3:before {
  background-image: url(./img/girl-or-boy-colors.jpg);
  background-size: contain;
  transform: translateZ(-1px) scale(2);
  z-index:-1;
}
#slide3 .title {
  margin-bottom: 1em;
}

#slide4 {
  background-image: url(./img/girl-or-boy-colors.jpg);
  background-size: contain;
}
</style>

<style>
@media screen and (max-width: 741px), screen and (max-height: 625px) {
h1 {
  font-size:140%
}
img:last-of-type {
  -webkit-transform: translateZ(0.5px) scale(0.5) translateX(17%) translateY(-26%) rotate(9deg);
  -moz-transform: translateZ(0.5px) scale(0.5) translateX(17%) translateY(-26%) rotate(9deg);
  -ms-transform: translateZ(0.5px) scale(0.5) translateX(17%) translateY(-26%) rotate(9deg);
  -o-transform: translateZ(0.5px) scale(0.5) translateX(17%) translateY(-26%) rotate(9deg);
  transform: translateZ(0.5px) scale(0.5) translateX(17%) translateY(-26%) rotate(9deg);
}
})
</style>

<style>
.scratch-container {
  position: relative;
  width: 512px;
  height: 362px;
  margin: 0 auto;
  -webkit-user-select: none;
  -moz-user-select: none;
  -ms-user-select: none;
  -o-user-select: none;
  user-select: none;
}
.scratch-canvas {
  position: absolute;
  top: 0;
  z-index: 1;
}
.scratch-prize {
  background: url(./img/scratch-prize.jpg);
  box-shadow: 0 0 8px rgba(0, 0, 0, .7);
  height: 100%;
  width: 100%;
  position: absolute;
  visibility: hidden;
}
.scratch-prize.reveal {
  box-shadow: 0 0 50px 30px rgba(255, 255, 255, 1), 0 0 10px 10px rgba(255, 255, 255, 1) inset;
  z-index: 11;
}
</style>
<script>
(function () { 'use strict';
  var isDrawing, lastPoint,
  revealAt = 40,
  attempts = 2,
  container = document.getElementById('.scratch-container'),
  canvas = document.querySelector('.scratch-canvas'),
  prize = document.querySelector('.scratch-prize'),
  canvasWidth = canvas.width,
  canvasHeight = canvas.height,
  ctx = canvas.getContext('2d'),
  cover = new Image(),
  brush = new Image();

  cover.src = './img/scratch-cover.png';
  cover.onload = function() {
    // Show the form when Image is loaded.
    prize.style.visibility = 'visible';
    ctx.drawImage(this, 20, 20, 512, 362, 0, 0, 512, 362);
  };
  brush.src = './img/brush.png';

  canvas.addEventListener('mousedown', handleMouseDown, false);
  canvas.addEventListener('touchstart', handleMouseDown, false);
  canvas.addEventListener('mousemove', handleMouseMove, false);
  canvas.addEventListener('touchmove', handleMouseMove, false);
  canvas.addEventListener('mouseup', handleMouseUp, false);
  canvas.addEventListener('touchend', handleMouseUp, false);

  function distanceBetween(point1, point2) {
    return Math.sqrt(Math.pow(point2.x - point1.x, 2) + Math.pow(point2.y - point1.y, 2));
  }

  function angleBetween(point1, point2) {
    return Math.atan2( point2.x - point1.x, point2.y - point1.y );
  }

  // Only test every `stride` pixel. `stride`x faster,
  // but might lead to inaccuracy
  function getFilledInPixels(stride) {
    if (!stride || stride < 1) { stride = 1; }

    var pixels = ctx.getImageData(0, 0, canvasWidth, canvasHeight),
    pdata = pixels.data,
    l = pdata.length,
    total = (l / stride),
    count = 0;

    // Iterate over all pixels
    for(var i = count = 0; i < l; i += stride) {
      if (parseInt(pdata[i]) === 0) {
        count++;
      }
    }

    return Math.round((count / total) * 100);
  }

  function getMouse(e, canvas) {
    if (e.layerX && e.layerY) {
      return {
        x: e.layerX,
        y: e.layerY
      };
    }
  }

  function handlePercentage(filledInPixels) {
    filledInPixels = filledInPixels || 0;
    var sP = document.getElementById('scratchPreload');
    sP && sP.parentNode.removeChild(sP);
    if (filledInPixels > revealAt) {
      canvas.parentNode.removeChild(canvas);
      prize.classList.remove('boy');
      prize.classList.remove('girl');
      prize.classList.add('reveal');
      PopConfetti();
      ga && (ga('send', 'event', 'scratch', 'complete'), true) || console.info('ga unavailable');
    // }
    // else if (Math.random()>.75) {
    //   prize.classList.remove('boy');
    //   prize.classList.remove('girl');
    //   prize.classList.add(['girl','boy'][~~(Math.random()>.5)])
  }
}

function handleMouseDown(e) {
  if (!e.layerX && 0>--attempts) {
    return handlePercentage(100);
  }
  isDrawing = true;
  lastPoint = getMouse(e, canvas);
}

function handleMouseMove(e) {
  if (!isDrawing) { return; }

  e.preventDefault();

  var currentPoint = getMouse(e, canvas),
  dist = distanceBetween(lastPoint, currentPoint),
  angle = angleBetween(lastPoint, currentPoint),
  x, y;
console.info('hMM', currentPoint, window.e=e);
  for (var i = 0; i < dist; i++) {
    x = lastPoint.x + (Math.sin(angle) * i) - 25;
    y = lastPoint.y + (Math.cos(angle) * i) - 25;
    ctx.globalCompositeOperation = 'destination-out';
    ctx.drawImage(brush, x, y);
  }

  lastPoint = currentPoint;
  handlePercentage(getFilledInPixels(32));
}

function handleMouseUp(e) {
  isDrawing = false;
}

})();
</script>

<style>
  #confetti {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    z-index: 10;
    pointer-events: none;
  }
</style>
<script>
  function PopConfetti () {
    var COLORS, Confetti, NUM_CONFETTI, PI_2, canvas, confetti, context, drawCircle, i, range, resizeWindow, xpos;

    NUM_CONFETTI = 350 + 200;

    COLORS = [[85, 71, 106], [174, 61, 99], [219, 56, 83], [244, 92, 68], [248, 182, 70]];

    COLORS = [
      [107,96,102],
      [136,118,130],
      [241,199,216],
      [228,141,192],
      [226,142,176]
    ];

    PI_2 = 2 * Math.PI;

    canvas = document.getElementById("confetti");

    context = canvas.getContext("2d");

    window.w = 0;

    window.h = 0;

    resizeWindow = function() {
      window.w = canvas.width = window.innerWidth;
      return window.h = canvas.height = window.innerHeight;
    };

    window.addEventListener('resize', resizeWindow, false);

    window.onload = function() {
      return setTimeout(resizeWindow, 0);
    };
    setTimeout(resizeWindow, 0);

    range = function(a, b) {
      return (b - a) * Math.random() + a;
    };

    drawCircle = function(x, y, r, style) {
      context.beginPath();
      context.arc(x, y, r, 0, PI_2, false);
      context.fillStyle = style;
      return context.fill();
    };

    xpos = 0.5;

    document.onmousemove = function(e) {
      return xpos = e.pageX / w;
    };

    window.requestAnimationFrame = (function() {
      return window.requestAnimationFrame || window.webkitRequestAnimationFrame || window.mozRequestAnimationFrame || window.oRequestAnimationFrame || window.msRequestAnimationFrame || function(callback) {
        return window.setTimeout(callback, 1000 / 60);
      };
    })();

    Confetti = (function() {
      function Confetti() {
        this.style = COLORS[~~range(0, COLORS.length)];
        this.rgb = "rgba(" + this.style[0] + "," + this.style[1] + "," + this.style[2];
        this.r = ~~range(2, 6);
        this.r2 = 2 * this.r;
        this.replace();
      }

      Confetti.prototype.replace = function() {
        this.opacity = 0;
        this.dop = 0.03 * range(1, 4);
        this.x = range(-this.r2, w - this.r2);
        this.y = range(-20, h - this.r2);
        this.xmax = w - this.r;
        this.ymax = h - this.r;
        this.vx = range(0, 2) + 8 * xpos - 5;
        return this.vy = 0.7 * this.r + range(-1, 1);
      };

      Confetti.prototype.draw = function() {
        var ref;
        this.x += this.vx;
        this.y += this.vy;
        this.opacity += this.dop;
        if (this.opacity > 1) {
          this.opacity = 1;
          this.dop *= -1;
        }
        if (this.opacity < 0 || this.y > this.ymax) {
          this.replace();
        }
        if (!((0 < (ref = this.x) && ref < this.xmax))) {
          this.x = (this.x + this.xmax) % this.xmax;
        }
        return drawCircle(~~this.x, ~~this.y, this.r, this.rgb + "," + this.opacity + ")");
      };

      return Confetti;

    })();

    confetti = (function() {
      var j, ref, results;
      results = [];
      for (i = j = 1, ref = NUM_CONFETTI; 1 <= ref ? j <= ref : j >= ref; i = 1 <= ref ? ++j : --j) {
        results.push(new Confetti);
      }
      return results;
    })();

    window.step = function() {
      var c, j, len, results;
      requestAnimationFrame(step);
      context.clearRect(0, 0, w, h);
      results = [];
      for (j = 0, len = confetti.length; j < len; j++) {
        c = confetti[j];
        results.push(c.draw());
      }
      return results;
    };

    step();

  }
</script>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-49442106-5', 'auto');
  ga('send', 'pageview');
</script>

</body>
</html>